<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç‚¹äº®å·æ¸ - äº’åŠ¨æ§åˆ¶å™¨</title>
    <style>
        /* 1. åŸºç¡€é‡ç½®ä¸å¸ƒå±€ */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            padding: 20px; 
            margin: 0; 
            background: linear-gradient(135deg, #0b1120 0%, #1785BF 100%); /* ä¸å¤§å±é£æ ¼ç»Ÿä¸€çš„æ·±è‰²èƒŒæ™¯ */
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        /* 2. å¡ç‰‡å®¹å™¨ */
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 100%;
            max-width: 400px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        /* 3. æ ‡é¢˜ä¸è£…é¥° */
        h1 { 
            color: #101B3B; 
            font-size: 24px; 
            margin: 0 0 25px 0; 
            font-weight: 800;
            letter-spacing: 1px;
        }
        .subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        /* 4. è¡¨å•å…ƒç´  */
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-size: 14px; 
            color: #1785BF; 
            font-weight: 700; 
        }
        
        select { 
            width: 100%; 
            padding: 14px; 
            border: 2px solid #e0e0e0; 
            border-radius: 12px; 
            font-size: 16px; 
            outline: none;
            background-color: #f9f9f9;
            box-sizing: border-box; 
            appearance: none; /* ç§»é™¤åŸç”Ÿæ ·å¼ */
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }
        select:focus { 
            border-color: #1785BF; 
            background-color: #fff;
            box-shadow: 0 0 0 4px rgba(23, 133, 191, 0.1);
        }
        
        /* 5. æŒ‰é’®æ ·å¼ */
        button { 
            width: 100%; 
            padding: 16px; 
            background: linear-gradient(90deg, #1785BF, #096dd9); 
            color: white; 
            border: none; 
            border-radius: 12px; 
            font-size: 18px; 
            font-weight: 600;
            cursor: pointer; 
            box-shadow: 0 4px 15px rgba(23, 133, 191, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }
        button:active { transform: scale(0.96); }
        button:disabled { 
            background: #ccc; 
            box-shadow: none; 
            cursor: not-allowed; 
        }

        .footer { margin-top: 25px; font-size: 12px; color: #aaa; }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ç‚¹äº®å·æ¸è¿çº¿</h1>
        <p class="subtitle">åœ¨ä¸‹æ–¹é€‰æ‹©æ‚¨çš„å®¶ä¹¡ä¸ç›®çš„åœ°<br>å¤§å±å¹•å°†å®æ—¶å±•ç¤ºæ‚¨çš„è½¨è¿¹</p>
        
        <div class="form-group">
            <label for="originSelect">ğŸš© èµ·ç‚¹åŸå¸‚</label>
            <select id="originSelect" required>
                <option value="">ç‚¹å‡»é€‰æ‹©èµ·ç‚¹...</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="destinationSelect">ğŸ ç»ˆç‚¹åŸå¸‚</label>
            <select id="destinationSelect" required>
                <option value="">ç‚¹å‡»é€‰æ‹©ç»ˆç‚¹...</option>
            </select>
        </div>

        <div class="form-group">
            <label for="weightSelect">âœ¨ æƒ…æ„Ÿæƒé‡ (çº¿æ¡ç²—ç»†)</label>
            <select id="weightSelect" required>
                <option value="1">1 (æ¶“æ¶“ç»†æµ)</option>
                <option value="3">3</option>
                <option value="5" selected>5 (é»˜è®¤)</option>
                <option value="7">7</option>
                <option value="10">10 (å®½é˜”å¤§é“)</option>
            </select>
        </div>

        <button onclick="submitHometown()" id="submitBtn">å‘å°„ä¿¡å·</button>
        <div class="footer">æ•°æ®å®æ—¶åŒæ­¥è‡³å¤§å± Â· Power by ECharts</div>
    </div>

    <script>
        // -------------------------- 1. åˆå§‹åŒ– Firebase --------------------------
        // é…ç½®å¿…é¡»ä¸ç”µè„‘ç«¯å®Œå…¨ä¸€è‡´
        const firebaseConfig = {
            apiKey: "AIzaSyC8ShQbPovscKxEH-uN7HkCBbKAN514u5Q",
            authDomain: "maptest-7cc7d.firebaseapp.com",
            databaseURL: "https://maptest-7cc7d-default-rtdb.firebaseio.com",
            projectId: "maptest-7cc7d",
            storageBucket: "maptest-7cc7d.firebasestorage.app",
            messagingSenderId: "420772513972",
            appId: "1:420772513972:web:76fb5ce8e19b82be66afe1"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // -------------------------- 2. åŠ¨æ€ç”ŸæˆåŸå¸‚ä¸‹æ‹‰é€‰é¡¹ --------------------------
        // è¯¥åˆ—è¡¨å·²æ›´æ–°ï¼Œä¸ç”µè„‘ç«¯ cityCoords çš„é”®å€¼ä¸¥æ ¼å¯¹åº”
        const cities = [
            // --- é‡åº†å¸‚ ---
            "é‡åº†å¸‚", "æ¸ä¸­åŒº", "å¤§æ¸¡å£åŒº", "æ±ŸåŒ—åŒº", "æ²™åªååŒº", "ä¹é¾™å¡åŒº", "å—å²¸åŒº", "åŒ—ç¢šåŒº", "æ¸åŒ—åŒº", "å·´å—åŒº", 
            "ä¸‡å·åŒº", "æ¶ªé™µåŒº", "é»”æ±ŸåŒº", "é•¿å¯¿åŒº", "æ±Ÿæ´¥åŒº", "åˆå·åŒº", "æ°¸å·åŒº", "å—å·åŒº", "ç¶¦æ±ŸåŒº", "å¤§è¶³åŒº", 
            "ç’§å±±åŒº", "é“œæ¢åŒº", "æ½¼å—åŒº", "è£æ˜ŒåŒº", "å¼€å·åŒº", "æ¢å¹³åŒº", "æ­¦éš†åŒº", "åŸå£å¿", "ä¸°éƒ½å¿", "å«æ±Ÿå¿", 
            "å¿ å¿", "äº‘é˜³å¿", "å¥‰èŠ‚å¿", "å·«å±±å¿", "å·«æºªå¿", "çŸ³æŸ±åœŸå®¶æ—è‡ªæ²»å¿", "ç§€å±±åœŸå®¶æ—è‹—æ—è‡ªæ²»å¿", "é…‰é˜³åœŸå®¶æ—è‹—æ—è‡ªæ²»å¿", "å½­æ°´è‹—æ—åœŸå®¶æ—è‡ªæ²»å¿",
            // --- å››å·çœ ---
            "æˆéƒ½å¸‚", "ç»µé˜³å¸‚", "å¾·é˜³å¸‚", "å®œå®¾å¸‚", "æ³¸å·å¸‚", "ä¹å±±å¸‚", "å—å……å¸‚", "è¾¾å·å¸‚", "è‡ªè´¡å¸‚", "æ”€æèŠ±å¸‚", 
            "å¹¿å…ƒå¸‚", "é‚å®å¸‚", "å†…æ±Ÿå¸‚", "çœ‰å±±å¸‚", "å¹¿å®‰å¸‚", "é›…å®‰å¸‚", "èµ„é˜³å¸‚", "å·´ä¸­å¸‚", "å‡‰å±±å½æ—è‡ªæ²»å·", 
            "é˜¿åè—æ—ç¾Œæ—è‡ªæ²»å·", "ç”˜å­œè—æ—è‡ªæ²»å·"
        ];

        // æ ¸å¿ƒï¼šä½¿ç”¨ä¸­æ–‡æ‹¼éŸ³æ’åºï¼Œä¿è¯å’Œç”µè„‘ç«¯é¡ºåºä¸€è‡´ï¼Œæ–¹ä¾¿å¯»æ‰¾
        cities.sort((a, b) => a.localeCompare(b, 'zh-CN'));

        const originSelect = document.getElementById("originSelect");
        const destinationSelect = document.getElementById("destinationSelect");
        
        // å¡«å……ä¸‹æ‹‰æ¡†
        cities.forEach(name => {
            const opt1 = document.createElement("option"); opt1.value = name; opt1.text = name;
            originSelect.add(opt1);
            
            const opt2 = document.createElement("option"); opt2.value = name; opt2.text = name;
            destinationSelect.add(opt2);
        });
        
        // -------------------------- 3. æäº¤é€»è¾‘ --------------------------
        function submitHometown() {
            const origin = originSelect.value.trim();
            const destination = destinationSelect.value.trim();
            const weight = document.getElementById("weightSelect").value;
            
            // æ ¡éªŒ
            if (!origin || !destination) {
                return alert("è¯·ç¡®ä¿ã€èµ·ç‚¹ã€‘å’Œã€ç»ˆç‚¹ã€‘éƒ½å·²é€‰æ‹©ï¼");
            }
            if (origin === destination) {
                return alert("èµ·ç‚¹å’Œç»ˆç‚¹ä¸èƒ½æ˜¯åŒä¸€ä¸ªåŸå¸‚å“¦~");
            }

            const btn = document.getElementById("submitBtn");
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerText = "ğŸš€ ä¿¡å·ä¼ è¾“ä¸­...";

            // æäº¤æ•°æ®
            // æ³¨æ„ï¼šæ‰‹æœºç«¯åªè´Ÿè´£â€œæäº¤æ„å›¾â€ï¼Œå®çº¿è¿˜æ˜¯è™šçº¿çš„æ¸²æŸ“é€»è¾‘ç”±ç”µè„‘ç«¯ç»Ÿä¸€åˆ¤æ–­
            db.ref("hometownSubmissions").push({
                origin: origin,
                destination: destination,
                weight: parseInt(weight),
                source: "Mobile_User", // æ ‡è®°æ¥æº
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                // æˆåŠŸåé¦ˆ
                btn.style.background = "linear-gradient(90deg, #52c41a, #389e0d)"; // å˜ç»¿
                btn.innerText = "âœ… å‘å°„æˆåŠŸï¼è¯·çœ‹å¤§å±";
                
                // 2ç§’åé‡ç½®æŒ‰é’®ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ¬¡æäº¤
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerText = originalText;
                    btn.style.background = ""; // æ¢å¤åŸè‰²
                    // å¯é€‰ï¼šé‡ç½®è¡¨å•
                    // originSelect.value = "";
                    // destinationSelect.value = "";
                }, 2000);
                
            }).catch(err => {
                alert("æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥");
                console.error(err);
                btn.disabled = false;
                btn.innerText = originalText;
            });
        }
    </script>
</body>
</html>
